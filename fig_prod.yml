elasticsearch:
  image: dockerfile/elasticsearch:latest
  ports: 
    - "9200"
    - "9300"
  volumes:
    - /data/easlitcsearch:/data
redis:
  image: redis
  ports:
    - "6379"
rabbitmq:
  image: raintank/rabbitmq
  ports:
    - "5672"
    - "15672"
mysql:
  image: mysql
  ports:
    - "3306"
  environment:
    MYSQL_ROOT_PASSWORD: rootpass
    MYSQL_DATABASE: grafana
    MYSQL_USER: grafana
    MYSQL_PASSWORD: password
  volumes:
    - /data/mysql:/var/lib/mysql
graphiteApi:
  image: raintank/graphite-api
  ports:
    - "8888"
  links:
    - elasticsearch:elasticsearch
  environment:
    GRAPHITE_influxdb_host: 10.82.84.2
grafana:
  image: raintank/grafana
  ports:
    - "3000"
  links: 
    - rabbitmq:rabbitmq
    - graphiteApi:graphite-api
    - mysql:mysql
    - elasticsearch:elasticsearch
  volumes:
    - /data/grafana/conf:/opt/raintank/grafana/conf
    - /data/grafana/data:/opt/raintank/grafana/data
raintankCollectorCtrl:
  image: raintank/collector-ctrl
  links:
    - rabbitmq:rabbitmq
    - grafana:grafana
    - redis:redis
  ports:
    - "8181"
raintankEvent:
  image: raintank/event
  links:
    - rabbitmq:rabbitmq
    - elasticsearch:elasticsearch
    - redis:redis
    - grafana:grafana
raintankMetric:
  image: raintank/metric
  links:
    - rabbitmq:rabbitmq
    - elasticsearch:elasticsearch
    - redis:redis
  environment:
    RAINTANK_carbon_host: 10.82.84.2
proxy:
  image: dockerfile/nginx
  ports:
    - "80:80"
    - "443:443"
    - "8443:8443"
  links:
    - grafana:grafana
    - raintankCollectorCtrl:collector-ctrl
  volumes:
    - /data/nginx/sites:/etc/nginx/sites-enabled
    - /data/nginx/certs:/etc/nginx/certs
